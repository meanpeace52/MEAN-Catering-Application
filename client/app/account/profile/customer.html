<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <h1>Profile</h1>
    </div>
    <div class="col-sm-12">
      <uib-tabset active="active">
        <uib-tab index="0" heading="Payments">
          <br />
          <div class="panel panel-default">
            <div class="panel-body">
              <table class="table table-condensed">
                <thead>
                <tr>
                  <th>Status</th>
                  <th>Date</th>
                  <th>Total</th>
                  <th>Event</th>
                  <th>Caterer</th>
                  <th>Invoice</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="event in events">
                  <td>
                    <span class="label label-info">{{event.paymentStatus}}</span>
                  </td>
                  <td>
                    <span ng-if="event.paymentStatus == 'paid'">{{event.paymentPaidDate | date: "longDate" }}</span>
                    <span ng-if="event.paymentStatus == 'hold'">{{event.paymentHoldDate | date: "longDate" }}</span>
                  </td>
                  <td>{{event.offer.invoice.total}}</td>
                  <td>{{event.name}}</td>
                  <td>{{event.offer.catererName}}</td>
                  <td><a class="btn btn-xs btn-success" ng-click="vm.showInvoice($event, event)">Invoice</a></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="row" ng-if="isInvoiceMode">
            <div class="col-sm-12">
              <header>Invoice</header>
              <article>
                <table class="table col-sm-12">
                  <thead>
                    <tr class="active">
                      <th class="col-sm-1">#</th>
                      <th class="col-sm-5">Event Description</th>
                      <th class="col-sm-2"># People</th>
                      <th class="col-sm-2">$ Per Person</th>
                      <th class="col-sm-2">$ Amount</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1</td>
                      <td>{{eventForInvoice.description}}</td>
                      <td>{{eventForInvoice.people.toFixed(2)}}</td>
                      <td>{{eventForInvoice.pricePerPerson.toFixed(2)}}</td>
                      <td>{{(eventForInvoice.people * eventForInvoice.pricePerPerson).toFixed(2)}}</td>
                    </tr>
                  </tbody>
                </table>
                <section class="col-sm-4 col-sm-offset-8">
                  <table class="table">
                    <tbody>
                      <tr ng-if="eventForInvoice.offer.counter">
                        <td>Counter</td>
                        <td>{{eventForInvoice.offer.counter.toFixed(2)}}</td>
                      </tr>
                      <tr>
                        <td>Sub Total</td>
                        <td>{{eventForInvoice.offer.invoice.service.toFixed(2)}}</td>
                      </tr>
                      <tr>
                        <td>Sales Tax ({{((eventForInvoice.offer.invoice.tax/eventForInvoice.offer.invoice.service) * 100).toFixed(2)}}%)</td>
                        <td>{{eventForInvoice.offer.invoice.tax.toFixed(2)}}</td>
                      </tr>
                      <tr>
                        <td><b>Total</b></td>
                        <td><b>{{eventForInvoice.offer.invoice.total.toFixed(2)}}</b></td>
                      </tr>
                      <tr class="success" ng-if="vm.user.role == 'user'">
                        <td>Charged to Credit Card</td>
                        <td>{{eventForInvoice.offer.invoice.total.toFixed(2)}}</td>
                      </tr>
                      <tr class="danger" ng-if="eventForInvoice.offer.invoice.refund">
                        <td>Refund</td>
                        <td>-{{eventForInvoice.offer.invoice.refund.toFixed(2)}}</td>
                      </tr>
                      <tr class="warning" ng-if="!eventForInvoice.offer.invoice.refund && eventForInvoice.offer.invoice.adjustment.client && vm.user.role == 'user'">
                        <td>Partial Refund</td>
                        <td>-{{eventForInvoice.offer.invoice.adjustment.client.toFixed(2)}}</td>
                      </tr>
                    </tbody>
                  </table>
                </section>
              </article>
            </div>
          </div>
        </uib-tab>
        <uib-tab index="1" heading="Profile">
          <br />
          <form class="form" name="form" ng-submit="vm.register(form)" novalidate>

            <div class="form-group" ng-class="{ 'has-success': form.name.$valid && vm.submitted,
                                                'has-error': form.name.$invalid && vm.submitted }">
              <label>First Name</label>

              <input type="text" name="firstname" class="form-control" ng-model="vm.user.firstname"
                     required/>
              <p class="help-block" ng-show="form.name.$error.required && vm.submitted">
                A name is required
              </p>
            </div>

            <div class="form-group" ng-class="{ 'has-success': form.name.$valid && vm.submitted,
                                                'has-error': form.name.$invalid && vm.submitted }">
              <label>Last Name</label>

              <input type="text" name="lastname" class="form-control" ng-model="vm.user.lastname"
                     required/>
              <p class="help-block" ng-show="form.name.$error.required && vm.submitted">
                A name is required
              </p>
            </div>

            <div class="form-group" ng-class="{ 'has-success': form.email.$valid && vm.submitted,
                                                'has-error': form.email.$invalid && vm.submitted }">
              <label>Email</label>

              <input type="email" name="email" class="form-control" ng-model="vm.user.email"
                     required
                     mongoose-error/>
              <p class="help-block" ng-show="form.email.$error.email && vm.submitted">
                Doesn't look like a valid email.
              </p>
              <p class="help-block" ng-show="form.email.$error.required && vm.submitted">
                What's your email address?
              </p>
              <p class="help-block" ng-show="form.email.$error.mongoose">
                {{ vm.errors.email }}
              </p>
            </div>
            <div class="alert alert-success" role="alert" ng-if="vm.saved">Account information is successfully saved</div>
            <div>
              <button class="btn btn-primary btn-lg btn-register" type="submit">
                Save Changes
              </button>
            </div>

          </form>
        </uib-tab>
        <uib-tab index="2" heading="Change password">
          <br />
          <form class="form" name="form" ng-submit="vm.changePassword(form)" novalidate>

            <div class="form-group">
              <label>Current Password</label>

              <input type="password" name="password" class="form-control" ng-model="vm.user.oldPassword"
                     mongoose-error/>
              <p class="help-block" ng-show="form.password.$error.mongoose">
                {{ vm.errors.other }}
              </p>
            </div>

            <div class="form-group">
              <label>New Password</label>

              <input type="password" name="newPassword" class="form-control" ng-model="vm.user.newPassword"
                     ng-minlength="3"
                     required/>
              <p class="help-block"
                 ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || vm.submitted)">
                Password must be at least 3 characters.
              </p>
            </div>

            <div class="form-group">
              <label>Confirm New Password</label>

              <input type="password" name="confirmPassword" class="form-control" ng-model="vm.user.confirmPassword"
                     match="vm.user.newPassword"
                     ng-minlength="3"
                     required=""/>
              <p class="help-block"
                 ng-show="form.confirmPassword.$error.match && vm.submitted">
                Passwords must match.
              </p>

            </div>

            <p class="help-block"> {{ vm.message }} </p>
            <div class="alert alert-success" role="alert" ng-if="vm.saved">Account information is successfully saved</div>
            <button class="btn btn-lg btn-primary" type="submit">Save changes</button>
          </form>
        </uib-tab>
        <uib-tab index="3" heading="Update Card" ng-if="vm.user.payableAccountId">
          <div style="padding:50px;">
              <credit-card-form verifier="false" ccupdate="true" user="vm.user" event=""></credit-card-form>
          </div>
        </uib-tab>
      </uib-tabset>
    </div>
  </div>
  <hr>
</div>
